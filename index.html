<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ateneo Voley</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 1em;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .player-card {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .player-card:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .player-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .player-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .player-info span {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }

        .close-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .stats-section {
            margin-top: 30px;
        }

        .stats-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }

        .partido-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .partido-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h4 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 2em;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .player-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Ateneo Voley</h1>
            <p>Gesti√≥n del equipo</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('jugadores')">üë• Jugadores</button>
            <button class="tab" onclick="switchTab('partidos')">üèê Partidos</button>
            <button class="tab" onclick="switchTab('estadisticas')">üìä Estad√≠sticas</button>
        </div>

        <div class="content">
            <!-- TAB JUGADORES -->
            <div id="jugadores" class="tab-content active">
                <h2 style="margin-bottom: 20px;">Agregar Jugador</h2>
                <form id="form-jugador" onsubmit="agregarJugador(event)">
                    <div class="form-group">
                        <label>Nombre y Apellido</label>
                        <input type="text" id="nombre" required>
                    </div>
                    <div class="form-group">
                        <label>Rama</label>
                        <select id="rama" required>
                            <option value="">Seleccionar...</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a</label>
                        <select id="categoria" required>
                            <option value="">Seleccionar...</option>
                            <option value="SUB 14">SUB 14</option>
                            <option value="SUB 16">SUB 16</option>
                            <option value="SUB 18">SUB 18</option>
                            <option value="SUB 21">SUB 21</option>
                            <option value="Mayores">Mayores</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dorsal</label>
                        <input type="number" id="dorsal" required>
                    </div>
                    <div class="form-group">
                        <label>Posici√≥n (mant√©n Ctrl/Cmd para seleccionar m√∫ltiples)</label>
                        <select id="posicion" multiple required style="height: 150px;">
                            <option value="Armador">Armador</option>
                            <option value="Opuesto">Opuesto</option>
                            <option value="Central">Central</option>
                            <option value="Punta">Punta</option>
                            <option value="L√≠bero">L√≠bero</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Agregar Jugador</button>
                </form>

                <h2 style="margin-top: 40px; margin-bottom: 20px;">Lista de Jugadores</h2>
                <div id="lista-jugadores"></div>
            </div>

            <!-- TAB PARTIDOS -->
            <div id="partidos" class="tab-content">
                <h2 style="margin-bottom: 20px;">Crear Partido</h2>
                <form id="form-partido" onsubmit="crearPartido(event)">
                    <div class="form-group">
                        <label>Rival</label>
                        <input type="text" id="rival" required>
                    </div>
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="fecha" required>
                    </div>
                    <div class="form-group">
                        <label>Rama</label>
                        <select id="rama-partido" required>
                            <option value="">Seleccionar...</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a</label>
                        <select id="categoria-partido" required>
                            <option value="">Seleccionar...</option>
                            <option value="SUB 14">SUB 14</option>
                            <option value="SUB 16">SUB 16</option>
                            <option value="SUB 18">SUB 18</option>
                            <option value="SUB 21">SUB 21</option>
                            <option value="Mayores">Mayores</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Local/Visitante</label>
                        <select id="local-visitante" required>
                            <option value="">Seleccionar...</option>
                            <option value="Local">Local</option>
                            <option value="Visitante">Visitante</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Crear Partido</button>
                </form>

                <h2 style="margin-top: 40px; margin-bottom: 20px;">Partidos Programados</h2>
                <div id="lista-partidos"></div>
            </div>

            <!-- TAB ESTAD√çSTICAS -->
            <div id="estadisticas" class="tab-content">
                <h2 style="margin-bottom: 20px;">Cargar Estad√≠sticas</h2>
                <form id="form-estadisticas" onsubmit="guardarEstadisticas(event)">
                    <div class="form-group">
                        <label>Partido</label>
                        <select id="select-partido" required onchange="actualizarJugadoresDisponibles()">
                            <option value="">Seleccionar partido...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Jugador</label>
                        <select id="select-jugador" required>
                            <option value="">Seleccionar jugador...</option>
                        </select>
                    </div>

                    <h3 style="margin: 30px 0 20px 0; color: #667eea;">Estad√≠sticas del Partido</h3>
                    
                    <div class="form-group">
                        <label>Saque Favorable</label>
                        <input type="number" id="saque-fav" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Saque Fallado</label>
                        <input type="number" id="saque-fall" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Ataque Favorable</label>
                        <input type="number" id="ataque-fav" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Ataque Fallado</label>
                        <input type="number" id="ataque-fall" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Bloqueo Favorable</label>
                        <input type="number" id="bloqueo-fav" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Bloqueo Fallado</label>
                        <input type="number" id="bloqueo-fall" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Armado Favorable</label>
                        <input type="number" id="armado-fav" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Armado Fallado</label>
                        <input type="number" id="armado-fall" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Recepci√≥n Doble Positiva</label>
                        <input type="number" id="recep-doble-pos" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Recepci√≥n Positiva</label>
                        <input type="number" id="recep-pos" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Recepci√≥n Negativa</label>
                        <input type="number" id="recep-neg" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Recepci√≥n Negativa de Juego</label>
                        <input type="number" id="recep-neg-juego" min="0" value="0" required>
                    </div>

                    <button type="submit" class="btn">Guardar Estad√≠sticas</button>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL PERFIL JUGADOR -->
    <div id="modal-jugador" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-nombre"></h2>
                <button class="close-btn" onclick="cerrarModal()">Cerrar</button>
            </div>
            <div id="modal-info"></div>
            <div class="stats-section">
                <h3>Eficiencia Global</h3>
                <div class="chart-container">
                    <canvas id="chart-global"></canvas>
                </div>
            </div>
            <div class="stats-section">
                <h3>Partidos Jugados</h3>
                <div id="partidos-jugados"></div>
            </div>
        </div>
    </div>

    <!-- MODAL PARTIDO ESPEC√çFICO -->
    <div id="modal-partido-stats" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-partido-titulo"></h2>
                <button class="close-btn" onclick="cerrarModalPartido()">Cerrar</button>
            </div>
            <div class="chart-container">
                <canvas id="chart-partido"></canvas>
            </div>
            <div id="stats-partido-detalle"></div>
        </div>
    </div>

    <script>
        // Datos en memoria
        let jugadores = [];
        let partidos = [];
        let estadisticas = [];
        let chartGlobal = null;
        let chartPartido = null;

        // Cargar datos al inicio
        async function cargarDatos() {
            try {
                const jugadoresData = await window.storage.get('jugadores');
                if (jugadoresData) jugadores = JSON.parse(jugadoresData.value);

                const partidosData = await window.storage.get('partidos');
                if (partidosData) partidos = JSON.parse(partidosData.value);

                const estadisticasData = await window.storage.get('estadisticas');
                if (estadisticasData) estadisticas = JSON.parse(estadisticasData.value);

                actualizarUI();
            } catch (error) {
                console.log('Iniciando con datos vac√≠os');
            }
        }

        // Guardar datos
        async function guardarDatos() {
            try {
                await window.storage.set('jugadores', JSON.stringify(jugadores));
                await window.storage.set('partidos', JSON.stringify(partidos));
                await window.storage.set('estadisticas', JSON.stringify(estadisticas));
            } catch (error) {
                console.error('Error al guardar:', error);
            }
        }

        // Cambiar tab
        function switchTab(tabName) {
            // Ocultar todos los tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Quitar clase active de botones
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));

            // Mostrar tab seleccionado
            document.getElementById(tabName).classList.add('active');

            // Activar bot√≥n correspondiente
            event.target.classList.add('active');

            // Actualizar UI seg√∫n el tab
            if (tabName === 'jugadores') {
                mostrarJugadores();
            } else if (tabName === 'partidos') {
                mostrarPartidos();
            } else if (tabName === 'estadisticas') {
                actualizarSelectPartidos();
            }
        }

        // Agregar jugador
        function agregarJugador(event) {
            event.preventDefault();
            
            const posicionSelect = document.getElementById('posicion');
            const posicionesSeleccionadas = Array.from(posicionSelect.selectedOptions).map(opt => opt.value);

            const jugador = {
                id: Date.now(),
                nombre: document.getElementById('nombre').value,
                rama: document.getElementById('rama').value,
                categoria: document.getElementById('categoria').value,
                dorsal: document.getElementById('dorsal').value,
                posicion: posicionesSeleccionadas
            };

            jugadores.push(jugador);
            guardarDatos();
            mostrarJugadores();
            document.getElementById('form-jugador').reset();
            alert('Jugador agregado exitosamente');
        }

        // Mostrar jugadores
        function mostrarJugadores() {
            const lista = document.getElementById('lista-jugadores');
            
            if (jugadores.length === 0) {
                lista.innerHTML = '<div class="empty-state"><h3>No hay jugadores</h3><p>Agrega tu primer jugador usando el formulario</p></div>';
                return;
            }

            lista.innerHTML = jugadores.map(j => `
                <div class="player-card" onclick="verPerfilJugador(${j.id})">
                    <h3>${j.nombre} #${j.dorsal}</h3>
                    <div class="player-info">
                        <span><strong>Rama:</strong> ${j.rama}</span>
                        <span><strong>Categor√≠a:</strong> ${j.categoria}</span>
                        <span><strong>Posici√≥n:</strong> ${j.posicion.join(', ')}</span>
                    </div>
                </div>
            `).join('');
        }

        // Crear partido
        function crearPartido(event) {
            event.preventDefault();

            const partido = {
                id: Date.now(),
                rival: document.getElementById('rival').value,
                fecha: document.getElementById('fecha').value,
                rama: document.getElementById('rama-partido').value,
                categoria: document.getElementById('categoria-partido').value,
                localVisitante: document.getElementById('local-visitante').value
            };

            partidos.push(partido);
            guardarDatos();
            mostrarPartidos();
            document.getElementById('form-partido').reset();
            alert('Partido creado exitosamente');
        }

        // Mostrar partidos
        function mostrarPartidos() {
            const lista = document.getElementById('lista-partidos');
            
            if (partidos.length === 0) {
                lista.innerHTML = '<div class="empty-state"><h3>No hay partidos</h3><p>Crea tu primer partido usando el formulario</p></div>';
                return;
            }

            lista.innerHTML = partidos.map(p => `
                <div class="partido-item">
                    <h3>vs ${p.rival}</h3>
                    <p><strong>Fecha:</strong> ${new Date(p.fecha).toLocaleDateString()}</p>
                    <p><strong>Rama:</strong> ${p.rama} | <strong>Categor√≠a:</strong> ${p.categoria}</p>
                    <p><strong>Tipo:</strong> ${p.localVisitante}</p>
                </div>
            `).join('');
        }

        // Actualizar select de partidos
        function actualizarSelectPartidos() {
            const select = document.getElementById('select-partido');
            select.innerHTML = '<option value="">Seleccionar partido...</option>' +
                partidos.map(p => `
                    <option value="${p.id}">vs ${p.rival} - ${new Date(p.fecha).toLocaleDateString()} (${p.rama} ${p.categoria})</option>
                `).join('');
        }

        // Actualizar jugadores disponibles seg√∫n el partido seleccionado
        function actualizarJugadoresDisponibles() {
            const partidoId = parseInt(document.getElementById('select-partido').value);
            const selectJugador = document.getElementById('select-jugador');

            if (!partidoId) {
                selectJugador.innerHTML = '<option value="">Seleccionar jugador...</option>';
                return;
            }

            const partido = partidos.find(p => p.id === partidoId);
            const jugadoresFiltrados = jugadores.filter(j => 
                j.rama === partido.rama && j.categoria === partido.categoria
            );

            selectJugador.innerHTML = '<option value="">Seleccionar jugador...</option>' +
                jugadoresFiltrados.map(j => `
                    <option value="${j.id}">${j.nombre} #${j.dorsal}</option>
                `).join('');
        }

        // Guardar estad√≠sticas
        function guardarEstadisticas(event) {
            event.preventDefault();

            const stat = {
                partidoId: parseInt(document.getElementById('select-partido').value),
                jugadorId: parseInt(document.getElementById('select-jugador').value),
                saqueFav: parseInt(document.getElementById('saque-fav').value),
                saqueFall: parseInt(document.getElementById('saque-fall').value),
                ataqueFav: parseInt(document.getElementById('ataque-fav').value),
                ataqueFall: parseInt(document.getElementById('ataque-fall').value),
                bloqueoFav: parseInt(document.getElementById('bloqueo-fav').value),
                bloqueoFall: parseInt(document.getElementById('bloqueo-fall').value),
                armadoFav: parseInt(document.getElementById('armado-fav').value),
                armadoFall: parseInt(document.getElementById('armado-fall').value),
                recepDoblePos: parseInt(document.getElementById('recep-doble-pos').value),
                recepPos: parseInt(document.getElementById('recep-pos').value),
                recepNeg: parseInt(document.getElementById('recep-neg').value),
                recepNegJuego: parseInt(document.getElementById('recep-neg-juego').value)
            };

            // Verificar si ya existe y actualizar, sino agregar
            const index = estadisticas.findIndex(e => 
                e.partidoId === stat.partidoId && e.jugadorId === stat.jugadorId
            );

            if (index !== -1) {
                estadisticas[index] = stat;
            } else {
                estadisticas.push(stat);
            }

            guardarDatos();
            document.getElementById('form-estadisticas').reset();
            alert('Estad√≠sticas guardadas exitosamente');
        }

        // Ver perfil de jugador
        function verPerfilJugador(jugadorId) {
            const jugador = jugadores.find(j => j.id === jugadorId);
            const modal = document.getElementById('modal-jugador');
            
            document.getElementById('modal-nombre').textContent = `${jugador.nombre} #${jugador.dorsal}`;
            document.getElementById('modal-info').innerHTML = `
                <div class="player-info">
                    <span><strong>Rama:</strong> ${jugador.rama}</span>
                    <span><strong>Categor√≠a:</strong> ${jugador.categoria}</span>
                    <span><strong>Posici√≥n:</strong> ${jugador.posicion.join(', ')}</span>
                </div>
            `;

            // Calcular estad√≠sticas globales
            const statsJugador = estadisticas.filter(e => e.jugadorId === jugadorId);
            const esLibero = jugador.posicion.length === 1 && jugador.posicion[0] === 'L√≠bero';
            
            mostrarGraficoGlobal(statsJugador, esLibero);
            mostrarPartidosJugados(jugadorId, statsJugador);

            modal.classList.add('active');
        }

        // Cerrar modal
        function cerrarModal() {
            document.getElementById('modal-jugador').classList.remove('active');
            if (chartGlobal) {
                chartGlobal.destroy();
                chartGlobal = null;
            }
        }

        // Mostrar gr√°fico global
        function mostrarGraficoGlobal(stats, esLibero) {
            if (chartGlobal) {
                chartGlobal.destroy();
            }

            const ctx = document.getElementById('chart-global').getContext('2d');

            let labels, data;

            if (esLibero) {
                // Solo recepci√≥n y armado para l√≠beros
                const totalRecep = stats.reduce((sum, s) => sum + s.recepDoblePos + s.recepPos, 0);
                const totalRecepNeg = stats.reduce((sum, s) => sum + s.recepNeg + s.recepNegJuego, 0);
                const totalArmado = stats.reduce((sum, s) => sum + s.armadoFav, 0);
                const totalArmadoFall = stats.reduce((sum, s) => sum + s.armadoFall, 0);

                const eficRecep = totalRecep + totalRecepNeg > 0 ? (totalRecep / (totalRecep + totalRecepNeg) * 100) : 0;
                const eficArmado = totalArmado + totalArmadoFall > 0 ? (totalArmado / (totalArmado + totalArmadoFall) * 100) : 0;

                labels = ['Recepci√≥n', 'Armado'];
                data = [eficRecep, eficArmado];
            } else {
                // Todas las estad√≠sticas para otros jugadores
                const totalSaque = stats.reduce((sum, s) => sum + s.saqueFav, 0);
                const totalSaqueFall = stats.reduce((sum, s) => sum + s.saqueFall, 0);
                const totalAtaque = stats.reduce((sum, s) => sum + s.ataqueFav, 0);
                const totalAtaqueFall = stats.reduce((sum, s) => sum + s.ataqueFall, 0);
                const totalBloqueo = stats.reduce((sum, s) => sum + s.bloqueoFav, 0);
                const totalBloqueoFall = stats.reduce((sum, s) => sum + s.bloqueoFall, 0);
                const totalArmado = stats.reduce((sum, s) => sum + s.armadoFav, 0);
                const totalArmadoFall = stats.reduce((sum, s) => sum + s.armadoFall, 0);
                const totalRecep = stats.reduce((sum, s) => sum + s.recepDoblePos + s.recepPos, 0);
                const totalRecepNeg = stats.reduce((sum, s) => sum + s.recepNeg + s.recepNegJuego, 0);

                const eficSaque = totalSaque + totalSaqueFall > 0 ? (totalSaque / (totalSaque + totalSaqueFall) * 100) : 0;
                const eficAtaque = totalAtaque + totalAtaqueFall > 0 ? (totalAtaque / (totalAtaque + totalAtaqueFall) * 100) : 0;
                const eficBloqueo = totalBloqueo + totalBloqueoFall > 0 ? (totalBloqueo / (totalBloqueo + totalBloqueoFall) * 100) : 0;
                const eficArmado = totalArmado + totalArmadoFall > 0 ? (totalArmado / (totalArmado + totalArmadoFall) * 100) : 0;
                const eficRecep = totalRecep + totalRecepNeg > 0 ? (totalRecep / (totalRecep + totalRecepNeg) * 100) : 0;

                labels = ['Saque', 'Ataque', 'Bloqueo', 'Armado', 'Recepci√≥n'];
                data = [eficSaque, eficAtaque, eficBloqueo, eficArmado, eficRecep];
            }

            chartGlobal = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Eficiencia (%)',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Mostrar partidos jugados
        function mostrarPartidosJugados(jugadorId, stats) {
            const container = document.getElementById('partidos-jugados');
            
            if (stats.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hay estad√≠sticas registradas</p></div>';
                return;
            }

            container.innerHTML = stats.map(s => {
                const partido = partidos.find(p => p.id === s.partidoId);
                if (!partido) return '';
                
                return `
                    <div class="partido-item" onclick="verEstadisticasPartido(${s.partidoId}, ${jugadorId})">
                        <h4>vs ${partido.rival}</h4>
                        <p>${new Date(partido.fecha).toLocaleDateString()} - ${partido.localVisitante}</p>
                        <p style="font-size: 0.9em; color: #667eea;">Click para ver estad√≠sticas del partido</p>
                    </div>
                `;
            }).join('');
        }

        // Ver estad√≠sticas de un partido espec√≠fico
        function verEstadisticasPartido(partidoId, jugadorId) {
            const jugador = jugadores.find(j => j.id === jugadorId);
            const partido = partidos.find(p => p.id === partidoId);
            const stat = estadisticas.find(e => e.partidoId === partidoId && e.jugadorId === jugadorId);

            if (!stat) return;

            const modal = document.getElementById('modal-partido-stats');
            document.getElementById('modal-partido-titulo').textContent = 
                `${jugador.nombre} vs ${partido.rival} - ${new Date(partido.fecha).toLocaleDateString()}`;

            const esLibero = jugador.posicion.length === 1 && jugador.posicion[0] === 'L√≠bero';
            mostrarGraficoPartido(stat, esLibero);
            mostrarDetalleStats(stat, esLibero);

            modal.classList.add('active');
        }

        // Cerrar modal partido
        function cerrarModalPartido() {
            document.getElementById('modal-partido-stats').classList.remove('active');
            if (chartPartido) {
                chartPartido.destroy();
                chartPartido = null;
            }
        }

        // Mostrar gr√°fico de partido espec√≠fico
        function mostrarGraficoPartido(stat, esLibero) {
            if (chartPartido) {
                chartPartido.destroy();
            }

            const ctx = document.getElementById('chart-partido').getContext('2d');

            let labels, data;

            if (esLibero) {
                const totalRecep = stat.recepDoblePos + stat.recepPos;
                const totalRecepNeg = stat.recepNeg + stat.recepNegJuego;
                const eficRecep = totalRecep + totalRecepNeg > 0 ? (totalRecep / (totalRecep + totalRecepNeg) * 100) : 0;
                const eficArmado = stat.armadoFav + stat.armadoFall > 0 ? (stat.armadoFav / (stat.armadoFav + stat.armadoFall) * 100) : 0;

                labels = ['Recepci√≥n', 'Armado'];
                data = [eficRecep, eficArmado];
            } else {
                const eficSaque = stat.saqueFav + stat.saqueFall > 0 ? (stat.saqueFav / (stat.saqueFav + stat.saqueFall) * 100) : 0;
                const eficAtaque = stat.ataqueFav + stat.ataqueFall > 0 ? (stat.ataqueFav / (stat.ataqueFav + stat.ataqueFall) * 100) : 0;
                const eficBloqueo = stat.bloqueoFav + stat.bloqueoFall > 0 ? (stat.bloqueoFav / (stat.bloqueoFav + stat.bloqueoFall) * 100) : 0;
                const eficArmado = stat.armadoFav + stat.armadoFall > 0 ? (stat.armadoFav / (stat.armadoFav + stat.armadoFall) * 100) : 0;
                const totalRecep = stat.recepDoblePos + stat.recepPos;
                const totalRecepNeg = stat.recepNeg + stat.recepNegJuego;
                const eficRecep = totalRecep + totalRecepNeg > 0 ? (totalRecep / (totalRecep + totalRecepNeg) * 100) : 0;

                labels = ['Saque', 'Ataque', 'Bloqueo', 'Armado', 'Recepci√≥n'];
                data = [eficSaque, eficAtaque, eficBloqueo, eficArmado, eficRecep];
            }

            chartPartido = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Eficiencia (%)',
                        data: data,
                        backgroundColor: 'rgba(118, 75, 162, 0.2)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(118, 75, 162, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(118, 75, 162, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Mostrar detalle de estad√≠sticas
        function mostrarDetalleStats(stat, esLibero) {
            const container = document.getElementById('stats-partido-detalle');

            if (esLibero) {
                container.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h4>Armado Favorable</h4>
                            <p>${stat.armadoFav}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Armado Fallado</h4>
                            <p>${stat.armadoFall}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n Doble +</h4>
                            <p>${stat.recepDoblePos}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n +</h4>
                            <p>${stat.recepPos}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n -</h4>
                            <p>${stat.recepNeg}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n - Juego</h4>
                            <p>${stat.recepNegJuego}</p>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h4>Saque Favorable</h4>
                            <p>${stat.saqueFav}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Saque Fallado</h4>
                            <p>${stat.saqueFall}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Ataque Favorable</h4>
                            <p>${stat.ataqueFav}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Ataque Fallado</h4>
                            <p>${stat.ataqueFall}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Bloqueo Favorable</h4>
                            <p>${stat.bloqueoFav}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Bloqueo Fallado</h4>
                            <p>${stat.bloqueoFall}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Armado Favorable</h4>
                            <p>${stat.armadoFav}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Armado Fallado</h4>
                            <p>${stat.armadoFall}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n Doble +</h4>
                            <p>${stat.recepDoblePos}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n +</h4>
                            <p>${stat.recepPos}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n -</h4>
                            <p>${stat.recepNeg}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Recepci√≥n - Juego</h4>
                            <p>${stat.recepNegJuego}</p>
                        </div>
                    </div>
                `;
            }
        }

        // Actualizar toda la UI
        function actualizarUI() {
            mostrarJugadores();
            mostrarPartidos();
            actualizarSelectPartidos();
        }

        // Inicializar aplicaci√≥n
        window.addEventListener('load', () => {
            cargarDatos();
        });

        // Cerrar modales al hacer click fuera
        window.addEventListener('click', (e) => {
            if (e.target.id === 'modal-jugador') {
                cerrarModal();
            }
            if (e.target.id === 'modal-partido-stats') {
                cerrarModalPartido();
            }
        });
    </script>
</body>
</html>
